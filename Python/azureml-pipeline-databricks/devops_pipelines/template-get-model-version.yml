steps:
- task: AzureCLI@1
  inputs:
    azureSubscription: DataOpsML Azure DevOps ML Model CI/CD pipeline
    scriptLocation: inlineScript
    inlineScript: |
      set -e # fail on error
      python ml_service/pipelines/verify_train_pipeline.py --build_id $(Build.BuildId) --output_model_version_file "model_version.txt"
      # Output model version to Azure DevOps job
      MODEL_VERSION="$(cat model_version.txt)"
      echo "##vso[task.setvariable variable=MODEL_VERSION]$MODEL_VERSION"
    workingDirectory: azureml
  name: 'getversion'
  displayName: "Determine if evaluation succeeded and new model is registered"
